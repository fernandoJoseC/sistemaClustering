{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de agrupamiento de datos por clustering</title>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }
      .header {
        background-color: #9c1944;
        padding: 20px;
        text-align: center;
        color: white;
      }
      .content {
        display: flex;
        justify-content: center;
        align-items: center;
        height: calc(
          50% - 10px
        ); /* Adjust height based on the header/footer size */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: auto; /* Changed from a calculated height to auto */
        padding: 20px; /* Add padding for spacing */
        gap: 20px; /* Space between items */
      }
      .translation-box {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 40px;
        width: 60%;
        max-width: 800px;
      }
      .file-types {
        display: flex;
        justify-content: space-around;
        margin-bottom: 30px;
      }
      .file-type {
        text-align: center;
        cursor: pointer;
      }
      .file-type img {
        width: 60px;
      }
      .upload-area {
        border: 2px dashed #9c1944;
        padding: 30px;
        text-align: center;
        color: #9c1944;
        font-size: 18px;
        cursor: pointer;
      }
      .upload-area:hover {
        background-color: white;
      }
      .submit-button {
        background-color: #9c1944;
        color: white;
        border: none;
        padding: 10px 20px;
        margin-top: 20px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 18px;
      }
      .submit-button:hover {
        background-color: #9c1944;
      }
      .charts-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around; /* This will put equal space around each chart */
        align-items: flex-start; /* Align items at the start of the container */
      }
      .charts-container2 {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around; /* This will put equal space around each chart */
        align-items: flex-start; /* Align items at the start of the container */
      }
      .chart {
        width: calc(33.3333% - 10px); /* Adjust the width to account for any margin or padding */
        margin: 5px; /* Optional margin for spacing between charts */
      }
      .chart2 {
        width: calc(50% - 10px); /* Adjust the width to account for any margin or padding */
        margin: 5px; /* Optional margin for spacing between charts */
      }
      canvas {
        max-width: 100%; /* Ensures the canvas is responsive and fits its container */
        height: auto; /* Adjust the height to maintain aspect ratio */
      }
      
      button {
        background-color: #9c1944; /* Color de fondo */
        color: white; /* Color del texto */
        border: none; /* Elimina el borde */
        padding: 10px 20px; /* Padding alrededor del texto */
        margin: 4px 2px; /* Margen alrededor de los botones */
        cursor: pointer; /* Cursor en forma de mano al pasar el mouse */
        text-align: center; /* Alineación del texto */
        text-decoration: none; /* Sin subrayado */
        display: inline-block; /* Para que se comporten como enlaces */
        font-size: 16px; /* Tamaño del texto */
        border-radius: 15px; /* Aquí se añade el borde redondeado */
      }
      
      button:hover {
        background-color: #EBA902; /* Color de fondo al pasar el mouse */
      }
      .footer {
        background-color: #9c1944; /* Color de fondo */
        color: white; /* Color del texto */
        text-align: center; /* Centra el texto */
        padding: 20px 0; /* Añade padding arriba y abajo */
        margin-top: 20px; /* Añade un margen arriba para separarlo del contenido */
        font-size: 16px; /* Tamaño del texto */
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Sistema de Agrupamiento de Datos por Agrupamiento</h1>
      
      <button onclick="window.location.href='{% url 'base:logout' %}';">Salir</button>
      <button onclick="window.location.href='{% url 'base:inicioView' %}';">Ir a Inicio</button>
      <button onclick="window.location.href='{% url 'base:introduccionView' %}';">Ir a Introducción</button>
    </div>
    
    <div class="content">
      <div class="translation-box">
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %} {{form}}
          <button type="submit" class="login-button">Iniciar</button>
        </form>
      </div>

      <h1>Gráficas basadas en el agrupamiento de los procesos de compra basado en sus características</h1>
      <h3>Estas gráficas son el resultado de haber realizado el agrupamiento de cada uno de los procesos de compra que se encontraban en el archivo con formato CSV. Este sistema realiza un agrupamiento mediante un modelo de Agrupamiento el cual se encarga de agrupar cada proceso de compra, dependiendo de sus características, a cada uno de los 3 grupos que existen, ALTA, MEDIA Y BAJA.</h3>
      <p>GRUPO 0: Procesos de compra cuya diferencia entre el presupuesto y el valor adjudicado está en un rango MEDIO</p>
      <p>GRUPO 1: Procesos de compra cuya diferencia entre el presupuesto y el valor adjudicado está en un rango ALTO</p>
      <p>GRUPO 2: Procesos de compra cuya diferencia entre el presupuesto y el valor adjudicado está en un rango BAJO</p>

      <div class="charts-container">
        <div class="chart">
          <h2>Presupuesto total por Grupos de procesos de compra por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico representa el total del presupuesto por cada Grupo de procesos de compra</p>
          <canvas id="myChart" width="900" height="800"></canvas>
        </div>
        <div class="chart">
          <h2>Valor adjudicado total por Grupos de procesos de compra por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico representa el total del valor adjudicado por cada tipo de cluster</p>
          <canvas id="myChart2" width="900" height="800"></canvas>
        </div>
        <div class="chart">
          <h2>Promedio de la diferencia por Grupos de procesos de compra por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico representa el total del promedio de la diferencia por cada grupo de procesos de compra, este gráfico es uno de los más importantes ya que nos indica un valor promedio que se da en cada grupo, esto permite identificar qué tipos de contratación y en qué provincias se hay más diferencia entre el presupuesto y el valor que se adjudica</p>
          <canvas id="myChart3" width="900" height="800"></canvas>
        </div>
      </div>
      <div class="charts-container2">
        <div class="chart2">
          <h2>Promedio de la diferencia por tipo de contratación Grupo 1 por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
          <canvas id="myChart4" width="900" height="800"></canvas>
        </div>
        <div class="chart2">
          <h2>Promedio de la diferencia por tipo de contratación Grupo 2 por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
          <canvas id="myChart5" width="900" height="800"></canvas>
        </div>
        <div class="chart2">
          <h2>Promedio de la diferencia por tipo de contratación Grupo 3 por PROVINCIAS</h2>
          <h4>Provincia: {{prov_ent}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
          <canvas id="myChart6" width="900" height="800"></canvas>
        </div>
        <div class="chart2">
          <h2>Promedio de la diferencia por provincia Grupo 1 por TIPO DE CONTRATACION</h2>
          <h4>Tipo de contratación: {{tipo_cont}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
          <canvas id="myChart7" width="900" height="800"></canvas>
        </div>
        <div class="chart2">
          <h2>Promedio de la diferencia por provincia Grupo 2 por TIPO DE CONTRATACION</h2>
          <h4>Tipo de contratación: {{tipo_cont}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
          <canvas id="myChart8" width="900" height="800"></canvas>
        </div>
        <div class="chart2">
          <h2>Promedio de la diferencia por provincia Grupo 3 por TIPO DE CONTRATACION</h2>
          <h4>Tipo de contratación: {{tipo_cont}}</h4>
          <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
          <canvas id="myChart9" width="900" height="800"></canvas>
        </div>
      </div>
      


      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          //Cargamos las variables con los datos del back
          const data1 = JSON.parse('{{ df_json|safe }}');
          const data2 = JSON.parse('{{ df2_json|safe }}');
          const data3 = JSON.parse('{{ df3_json|safe }}');
          const data4 = JSON.parse('{{ df4_json|safe }}');
          const data5 = JSON.parse('{{ df5_json|safe }}');
          const data6 = JSON.parse('{{ df6_json|safe }}');
          const data7 = JSON.parse('{{ df7_json|safe }}');
          const data8 = JSON.parse('{{ df8_json|safe }}');
          const data9 = JSON.parse('{{ df9_json|safe }}');


          //
          const ctx1 = document.getElementById('myChart');
          const chart1 = new Chart(ctx1, {
            type: 'bar',
            data: {
              labels: data1.map(item => item.cluster),
              
              datasets: [{
                label: 'Presupuesto por Cluster',
                data: data1.map(item => item.presupuesto),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(224,225,225)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(224,225,225, 1)'], // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });


          const ctx2 = document.getElementById('myChart2');
          const chart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
              labels: data2.map(item => item.cluster),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Val Adj por Cluster',
                data: data2.map(item => item.valAdj),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(224,225,225)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(224,225,225, 1)'], // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });

          const ctx3 = document.getElementById('myChart3');
          const chart3 = new Chart(ctx3, {
            type: 'bar',
            data: {
              labels: data3.map(item => item.cluster),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Diferencia por Cluster',
                data: data3.map(item => item.diferencia),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(224,225,225)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(224,225,225, 1)'],// Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });

          const ctx4 = document.getElementById('myChart4');
          const chart4 = new Chart(ctx4, {
            type: 'line',
            data: {
              labels: data4.map(item => item.tipo_contrato_cero),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Tipo de Contratación en Cluster 0',
                data: data4.map(item => item.promedio_diferencia_cero),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
          const ctx5 = document.getElementById('myChart5');
          const chart5 = new Chart(ctx5, {
            type: 'line',
            data: {
              labels: data5.map(item => item.tipo_contrato_uno),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Tipo de Contratación en Cluster 1',
                data: data5.map(item => item.promedio_diferencia_uno),
                backgroundColor: 'rgb(235,169,2)',
                borderColor: 'rgba(235,169,2, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
          const ctx6 = document.getElementById('myChart6');
          const chart6 = new Chart(ctx6, {
            type: 'line',
            data: {
              labels: data6.map(item => item.tipo_contrato_dos),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Tipo de Contratación en Cluster 2',
                data: data6.map(item => item.promedio_diferencia_dos),
                backgroundColor: 'rgb(224,225,225)',
                borderColor: 'rgba(224,225,225, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
          const ctx7 = document.getElementById('myChart7');
          const chart7 = new Chart(ctx7, {
            type: 'line',
            data: {
              labels: data7.map(item => item.provincias_cero),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Provincia cluster 0',
                data: data7.map(item => item.promedio_diferencia_provincia_cero),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
          const ctx8 = document.getElementById('myChart8');
          const chart8 = new Chart(ctx8, {
            type: 'line',
            data: {
              labels: data8.map(item => item.provincias_uno),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Provincia cluster 1',
                data: data8.map(item => item.promedio_diferencia_provincia_uno),
                backgroundColor: 'rgb(235,169,2)',
                borderColor: 'rgba(235,169,2, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
          const ctx9 = document.getElementById('myChart9');
          const chart9 = new Chart(ctx9, {
            type: 'line',
            data: {
              labels: data9.map(item => item.provincias_dos),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de la diferencia por Provincia cluster 2',
                data: data9.map(item => item.promedio_diferencia_provincia_dos),
                backgroundColor: 'rgb(224,225,225)',
                borderColor: 'rgba(224,225,225, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        });
      </script>
      
      
    </div>
  </body>
  <footer class="footer">
    Propiedad de la UIDE
  </footer>
</html>
{% endblock content %}