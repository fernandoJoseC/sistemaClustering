{% extends "base.html" %}
{% load static%}
{% load crispy_forms_tags %}
{% block content %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>Sistema de agrupamiento de datos por clustering</title>
    <style>
      .form-control {
        display: block;
        width: 100%; /* Ocupa el ancho completo del contenedor padre */
        padding: 0.375rem 0.75rem; /* Espaciado interno para que el texto no esté justo en el borde */
        font-size: 1rem; /* Tamaño de fuente estándar */
        font-weight: 400; /* Peso de la fuente normal */
        line-height: 1.5; /* Altura de línea para un buen espaciado de texto */
        color: #495057; /* Color de texto oscuro para mejor legibilidad */
        background-color: #fff; /* Fondo blanco */
        background-clip: padding-box; /* Asegura que el fondo solo cubre el área de padding */
        border: 1px solid #ced4da; /* Borde sutil */
        border-radius: 0.25rem; /* Bordes redondeados */
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; /* Transición suave para efectos hover y focus */
    
        /* Efecto de sombra al enfocar el campo (focus) */
        box-shadow: none; /* Sin sombra inicialmente */
      }
      
      .form-control:focus {
          color: #495057; /* Mantiene el color del texto al enfocar */
          background-color: #fff; /* Mantiene el fondo blanco al enfocar */
          border-color: #80bdff; /* Cambia el color del borde a un azul claro al enfocar */
          outline: 0; /* Elimina el contorno que los navegadores colocan al enfocar */
          box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* Añade una sombra ligera con un halo azul */
      }
      
      /* Estilo para manejar la apariencia cuando el campo tiene un valor inválido */
      .form-control.is-invalid {
          border-color: #e3342f; /* Borde rojo para indicar error */
          background-image: none; /* Sin imagen de fondo */
      }
      
      /* Estilo para manejar la apariencia cuando el campo tiene un valor válido */
      .form-control.is-valid {
          border-color: #38c172; /* Borde verde para indicar valor válido */
      }
      body,
      html {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }
      .header {
        background-color: #9c1944;
        padding: 20px;
        text-align: center;
        color: white;
      }
      .content {
        display: flex;
        justify-content: center;
        align-items: center;
        height: calc(
          50% - 10px
        ); /* Adjust height based on the header/footer size */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: auto; /* Changed from a calculated height to auto */
        padding: 20px; /* Add padding for spacing */
        gap: 20px; /* Space between items */
      }
      .translation-box {
        background-color: #EBA902;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 40px;
        width: 50%; /* Aumentar el porcentaje según necesidad */
        max-width: 960px; /* O un máximo en píxeles que prefieras */
        margin: auto; /* Para centrar el contenedor si es más pequeño que el ancho de la ventana */
      }
      .file-types {
        display: flex;
        justify-content: space-around;
        margin-bottom: 30px;
      }
      .file-type {
        text-align: center;
        cursor: pointer;
      }
      .file-type img {
        width: 60px;
      }
      .upload-area {
        border: 2px dashed #9c1944;
        padding: 30px;
        text-align: center;
        color: #9c1944;
        font-size: 18px;
        cursor: pointer;
      }
      .upload-area:hover {
        background-color: white;
      }
      .submit-button {
        background-color: #9c1944;
        color: white;
        border: none;
        padding: 10px 20px;
        margin-top: 20px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 18px;
      }
      .submit-button:hover {
        background-color: #9c1944;
      }
      .charts-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around; /* This will put equal space around each chart */
        align-items: flex-start; /* Align items at the start of the container */
      }
      .charts-container2 {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around; /* This will put equal space around each chart */
        align-items: flex-start; /* Align items at the start of the container */
      }
      .chart {
        width: calc(33.3333% - 10px); /* Adjust the width to account for any margin or padding */
        margin: 28; /* Optional margin for spacing between charts */
      }
      .chart2 {
        width: calc(50% - 10px); /* Adjust the width to account for any margin or padding */
        margin: 28px; /* Optional margin for spacing between charts */
      }
      canvas {
        max-width: 100%; /* Ensures the canvas is responsive and fits its container */
        height: auto; /* Adjust the height to maintain aspect ratio */
      }
      
      button {
        background-color: #9c1944; /* Color de fondo */
        color: white; /* Color del texto */
        border: none; /* Elimina el borde */
        padding: 10px 20px; /* Padding alrededor del texto */
        margin: 4px 2px; /* Margen alrededor de los botones */
        cursor: pointer; /* Cursor en forma de mano al pasar el mouse */
        text-align: center; /* Alineación del texto */
        text-decoration: none; /* Sin subrayado */
        display: inline-block; /* Para que se comporten como enlaces */
        font-size: 16px; /* Tamaño del texto */
        border-radius: 15px; /* Aquí se añade el borde redondeado */
      }
      
      button:hover {
        background-color: #EBA902; /* Color de fondo al pasar el mouse */
      }
      .footer {
        background-color: #9c1944; /* Color de fondo */
        color: white; /* Color del texto */
        text-align: center; /* Centra el texto */
        padding: 20px 0; /* Añade padding arriba y abajo */
        margin-top: 20px; /* Añade un margen arriba para separarlo del contenido */
        font-size: 16px; /* Tamaño del texto */
      }
    
      /* Estilos para los labels de los checkboxes */
      .chart-label {
        display: inline-block; /* Alinea los checkboxes horizontal o verticalmente */
        background-color: #f5f5f5; /* Color de fondo ligero para contraste */
        color: #9c1944; /* Color del texto para coincidir con el esquema de color principal */
        margin: 10px; /* Espacio alrededor de los labels para evitar aglomeración */
        padding: 5px 10px; /* Padding para dar más espacio dentro del label */
        border-radius: 5px; /* Bordes redondeados para suavizar la apariencia */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Sombra sutil para profundidad */
        cursor: pointer; /* Indica al usuario que el label es interactivo */
      }
    
      /* Estilo para los checkboxes para que coincidan con el estilo de los labels */
      .chart-label input[type="checkbox"] {
        margin-right: 5px; /* Espacio entre el checkbox y el texto */
      }
    
      /* Cambios al hacer hover sobre los labels para mejorar la interactividad */
      .chart-label:hover {
        background-color: #eaeaea; /* Ligeramente más oscuro al pasar el mouse */
      }
      .mi-formulario {
        width: 100%;
        max-width: 650px;
        margin: 20px auto;
        padding: 20px;
        background: #ffffff;  /* Fondo claro para los formularios */
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  /* Sombra sutil para dar profundidad */
        font-family: 'Arial', sans-serif;  /* Tipografía coherente */
      }
      
      .mi-formulario .form-group {
          margin-bottom: 20px;  /* Más espacio entre campos */
      }
      
      .mi-formulario .form-control {
          width: 100%;
          padding: 12px 15px;  /* Más padding para mejor accesibilidad */
          border: 1px solid #ccc;  /* Borde sutil */
          border-radius: 4px;  /* Bordes redondeados */
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);  /* Sombra interior para efecto de profundidad */
          transition: border-color 0.3s;  /* Transición suave del color del borde */
      }
      
      .mi-formulario .form-control:focus {
          border-color: #9c1944;  /* Cambio de color al enfocar */
          outline: none;  /* Elimina el contorno predeterminado */
      }
      
      .mi-formulario .login-button {
          background-color: #9c1944;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.3s;  /* Transición suave del color de fondo */
      }
      
      .mi-formulario .login-button:hover {
          background-color: #45a049;  /* Cambio de color al pasar el mouse */
      }
      /* Establece tus contenedores para usar flexbox y envolver cuando sea necesario */
      .charts-container, .charts-container2 {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between; /* Esto colocará espacio entre tus tarjetas */
          align-items: flex-start;
          gap: 20px; /* Define el espacio entre las tarjetas, puedes ajustar este valor a tu gusto */
      }
      .chart, .chart2 {
        width: calc(45%); /* Ajusta los 10px según el espacio que desees entre tarjetas */
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 0.25rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        box-sizing: border-box; /* Asegura que el padding y el borde están incluidos en el ancho */
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      /* Para pantallas más pequeñas, puedes querer que las tarjetas tomen el 100% del ancho */
      @media (max-width: 768px) {
          .chart, .chart2 {
              width: 100%; /* Las tarjetas se expandirán para ocupar el ancho completo en dispositivos móviles */
          }
      }
      
      
      .chart:hover, .chart2:hover {
          transform: translateY(-5px); /* Mueve la tarjeta ligeramente hacia arriba al pasar el mouse */
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Sombra más pronunciada al pasar el mouse */
      }
      
      /* Si deseas agregar un encabezado a la tarjeta, puedes usar algo como esto: */
      .chart-header, .chart2-header {
          padding-bottom: 10px; /* Espaciado debajo del encabezado de la tarjeta */
          margin-bottom: 20px; /* Margen debajo del encabezado de la tarjeta */
          border-bottom: 1px solid #eee; /* Línea debajo del encabezado para separarlo del contenido */
          text-align: center; /* Centrado de texto */
          color: #333; /* Color de texto oscuro para contraste */
          font-size: 1.25rem; /* Tamaño de fuente para el encabezado */
      }
      .chart-description {
        position: fixed; /* Posición fija en la pantalla */
        top: 50%; /* Empieza en la mitad de la pantalla */
        left: 50%; /* Empieza en la mitad de la pantalla */
        transform: translate(-50%, -50%); /* Centra el div exactamente en el centro de la pantalla */
        background-color: #C2C2C2;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        padding: 20px;
        border-radius: 5px;
        display: none;
        z-index: 10; /* Asegúrate de que está por encima de otros elementos */
        width: 80%; /* Ajusta al ancho deseado */
        max-width: 600px;
        color: white;
      }
      .chart-description button.close-button {
        position: absolute;
        top: 10px; /* Espaciado desde la parte superior del card */
        right: 10px; /* Espaciado desde la parte derecha del card */
        background-color: transparent;
        border: none;
        font-size: 1.5rem; /* Tamaño del icono de cierre */
        cursor: pointer;
      }
      
      /* Esto posiciona la descripción cerca del botón que se hizo clic */
      .chart button.active + .chart-description {
        display: block;
        top: 50%; /* Ajustar según sea necesario */
        left: 50%;
        transform: translateX(50%);
      }
      
      /* Opcional: Animación para fade-in */
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      .chart-description {
        animation: fadeIn 0.5s;
      }
      .translation-box h2{
        color: white;
        text-align: center;
      }
      .titulos {
        width: 1200px;
      }
      .titulos h1 {
        text-align:center;
      }
      .titulos p {
        font-size:20px;
        text-align:center;
      }
      .chart2 h2 {
        text-align: center;
      }
      .chart2 h4 {
        text-align: center;
        color: black;
        font-size: 20px;
      }
      .row {
        display: flex; /* Activa Flexbox para la fila */
        flex-wrap: wrap; /* Permite que los elementos de la fila se envuelvan según sea necesario */
        justify-content: space-between; /* Distribuye espacio uniformemente entre columnas */
        align-items: stretch; /* Alinea los elementos de columna verticalmente */
      }
      
      .column {
          flex: 1 1 30%; /* Permite que cada columna crezca pero no exceda del 30% del ancho del contenedor */
          margin: 10px; /* Añade un margen alrededor de cada columna para separarlas */
          padding: 20px; /* Espaciado interno dentro de cada columna */
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra para dar profundidad */
          background-color: #ffffff; /* Fondo blanco para la columna */
          border-radius: 8px; /* Bordes redondeados */
          transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .column:hover {
        transform: translateY(-5px); /* Eleva la tarjeta al pasar el mouse */
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25); /* Sombra más pronunciada al pasar el mouse */
    }
      
      /* Estilos para responder a diferentes tamaños de pantalla */
      @media (max-width: 1024px) {
          .column {
              flex: 1 1 45%; /* Dos columnas por fila en pantallas medianas */
          }
      }
      
      @media (max-width: 768px) {
          .column {
              flex: 1 1 100%; /* Una columna por fila en pantallas pequeñas */
          }
      }    
      .descVariables h3 {
        color : #EBA902;
        font-size: 20px;
      }
      .descVariables h2 {
        color : white;
        font-size: 20px;
      }
      
    </style>
    
  </head>
  <body>
    <div class="header">
      <h1>Sistema de Agrupamiento de Datos por Agrupamiento</h1>
      
      <button onclick="window.location.href='{% url 'base:logout' %}';">Salir</button>
      <button onclick="window.location.href='{% url 'base:inicioView' %}';">Ir a Inicio</button>
      <button onclick="window.location.href='{% url 'base:introduccionView' %}';">Ir a Introducción</button>
      <button onclick="window.location.href='{% url 'base:prediccionView' %}';">Ir a Prediccion</button>
      <button onclick="window.location.href='{% url 'base:webscrappingView' %}';">Ir a Web Scrapping</button>
    </div>
    

    
    <div class="content">
      <h1>Introducción</h1>
      <div class="descVariables">
        <div class="row">
          <div class="column">
            <h3>Clustering</h3>
            <p>El clustering, o agrupamiento, es una técnica de análisis de datos que organiza objetos en grupos basados en su similitud. Se utiliza ampliamente para descubrir estructuras en los datos y mejorar la toma de decisiones.</p>
          </div>
          <div class="column">
            <h3>Clusters o Grupos</h3>
            <p>El agrupamiento de los datos se realiza dependiendo del número de clusters que nosotros definamos, estos clusters podemos denominarlos como grupos para una mejor comprensión de los resultados y las gráficas.</p>
            <button onclick="toggleDescription(this, 'info3')">Leer más</button>
            <div id="info3" class="chart-description" style="display: none;">
              <!-- Aquí irá la descripción que quieres mostrar -->
              <p>Al momento de realizar clustering, el resultado de este procedimiento son a qué cluster pertenece cada observación o proceso de compra, se asigna desde el 0 hasta el total de clusters que hayamos definido, es así que:</p>
              <p>Los datos que pertenecen al Cluster 0, son igualmente los datos que pertenecen al Grupo 1</p>
              <p>Los datos que pertenecen al Cluster 1, son igualmente los datos que pertenecen al Grupo 2</p>
              <p>Los datos que pertenecen al Cluster 2, son igualmente los datos que pertenecen al Grupo 3</p>
              <p>Los datos que pertenecen al Cluster 3, son igualmente los datos que pertenecen al Grupo 4</p>
              <p>Los datos que pertenecen al Cluster 4, son igualmente los datos que pertenecen al Grupo 5</p>
              <p>En resumen, por ejemplo, si observamos que hay datos en el cluster 2, podemos decir que son los mismos datos que están en el Grupo 3</p>
              <button onclick="closeDescription('info3')">Cerrar</button>
            </div>
          </div>
          <div class="column">
            <h3>Filtros para realizar el agrupamiento</h3>
            <p>Primeramente se debe de subir un archivo en formato CSV, este puede ser descargado de la pagina de la SERCOP; tambien puede usarse cualquier otro CSV que contenga las mismas variables para el proceso de agrupamiento.</p>
            <button onclick="toggleDescription(this, 'info1')">Leer más</button>
            <div id="info1" class="chart-description" style="display: none;">
              <!-- Aquí irá la descripción que quieres mostrar -->
              <h2>Nombre de la Provincia</h2>
              <p>Se puede filtrar qué Provincia es la que queremos visualizar, puede ser una provincia en específico o Todas.</p>
              <h2>Tipo de Contratación</h2>
              <p>Se puede filtrar qué Tipo de Contratación queremos visualizar, igualmente se puede escoger un Tipo de Contratación, o Todos.</p>
              <h2>Número de Clusters</h2>
              <p>Podemos escoger en cuántos grupos/clusters queremos que nuestros datos se agrupen. Se recomienda que se realice un análisis agrupando con diferentes números de clusters para que se pueda apreciar cómo se agrupan mejor nuestros datos y podamos tomar mejores decisiones.</p>
              <p>Si desea conocer más información sobre el portal web de la SERCOP, puedes acceder desde aqui <a href="https://portal.compraspublicas.gob.ec/sercop/cifras/">Acceso al portal de cifras de compras públicas</a></p>
              <button onclick="closeDescription('info1')">Cerrar</button>
            </div>
          </div>
          <div class="column">
            <h3>Introducción de los gráficos</h3>
            <p>Cada gráfico generado a partir de la carga y filtrado del archivo CSV, generará diferentes gráficas las cuales describirán el resultado del agrupamiento por clusters.</p>
            <button onclick="toggleDescription(this, 'info2')">Leer más</button>
            <div id="info2" class="chart-description" style="display: none;">
              <!-- Aquí irá la descripción que quieres mostrar -->
              <h2>Presupuesto Total por Grupos</h2>
              <p>Este gráfico representa el total del presupuesto por cada grupo o cluster que se haya definido al momento de realizar el agrupamiento. Este gráfico nos ayudará a definir cúanto se ha presupuestado por cada grupo generado.</p>
              <p>De igual manera si aplicamos el filtro de Provincia, se visualizará el Presupuesto Total por cada Grupo en esa provincia en específico.</p>
              <h2>Valor Adjudicado por Grupos</h2>
              <p>Este gráfico representa el total del valor adjudicado por cada grupo o cluster que se haya definido al momento de realizar el agrupamiento. Este gráfico nos ayudará a definir cúanto se ha gastado, del presupuesto inicial asignado, realmente por cada grupo generado.</p>
              <h2>Diferencia por Grupos</h2>
              <p>Este grafico es el resulato de haber realizado un cálculo entre el presupuesto y el valor adjudicado. El resultado de la diferencia entre el presupuesto y el valor adjudicado de cada proceso de compra, calculamos su promedio por cada cluster o grupo y lo presentamos en esta gráfica. Esta gráfica nos ayudará a determinar en qué grupo es donde más existe diferencia entre el valor inicial presupuestado, y el valor que se terminó pagando por ese proceso de compra.</p>
              <h2>Diferencia por Tipo de Contratación</h2>
              <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
              <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
              <h2>Diferencias por Provincia</h2>
              <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
              <button onclick="closeDescription('info2')">Cerrar</button>
            </div>
          </div>
        </div>    
      </div>
      <div class="titulos">
        <h1>Gráficas basadas en el agrupamiento de los procesos de compra basado en sus características</h1>
        <p>Estas gráficas son el resultado de haber realizado el agrupamiento de cada uno de los procesos de compra que se encontraban en el archivo con formato CSV. Este sistema realiza un agrupamiento mediante un modelo de Clustering el cual se encarga de agrupar cada proceso de compra, dependiendo de sus características, a cada uno de los Clusters o Grupos que se definan al momento de realizar el proceso</p>
      </div>
    </div>
    <div class="translation-box">
      <h2>Sube un documento CSV</h2>
      <form method="POST" enctype="multipart/form-data" class="mi-formulario">
        {% csrf_token %}
        {{form | crispy}}
        <button type="submit" class="login-button">Iniciar</button>
      </form>
    </div>
    
    <div class="charts-container">
      <div class="chart2" id="chart1Container">
        <h2>Presupuesto Total por Grupos</h2>
        <h4>Provincia {{prov_ent}}</h4>
        <canvas id="myChart" width="900" height="800"></canvas>
        <button onclick="toggleDescription(this, 'desc1')">Descripción</button>
        <div id="desc1" class="chart-description" style="display: none;">
          <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Este gráfico representa el total del presupuesto por cada grupo o cluster que se haya definido al momento de realizar el agrupamiento. Este gráfico nos ayudará a definir cúanto se ha presupuestado por cada grupo generado.</p>
            <p>De igual manera si aplicamos el filtro de Provincia, se visualizará el Presupuesto Total por cada Grupo en esa provincia en específico.</p>
            <button onclick="closeDescription('desc1')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart2Container">
          <h2>Valor Adjudicado Total por Grupos</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <canvas id="myChart2" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc2')">Descripción</button>
          <div id="desc2" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Este gráfico representa el total del valor adjudicado por cada grupo o cluster que se haya definido al momento de realizar el agrupamiento. Este gráfico nos ayudará a definir cúanto se ha gastado, del presupuesto inicial asignado, realmente por cada grupo generado.</p>
            <p>De igual manera si aplicamos el filtro de Provincia, se visualizará el Valor Adjudicado por cada Grupo en esa provincia en específico.</p>
            <button onclick="closeDescription('desc2')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart3Container">
          <h2>Ahorro del presupuesto por Grupos</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <canvas id="myChart3" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc3')">Descripción</button>
          <div id="desc3" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Este grafico es el resulato de haber realizado un cálculo entre el presupuesto y el valor adjudicado. El resultado de la diferencia entre el presupuesto y el valor adjudicado de cada proceso de compra, calculamos su promedio por cada cluster o grupo y lo presentamos en esta gráfica. Esta gráfica nos ayudará a determinar en qué grupo es donde más existe diferencia entre el valor inicial presupuestado, y el valor que se terminó pagando por ese proceso de compra. </p>
            <p>Este gráfico representa el ahorro que se tuvo por cada grupo.</p>
            <p>De igual manera si aplicamos el filtro de Provincia, se visualizará la Diferencia cada Grupo en esa provincia en específico.</p>
            <button onclick="closeDescription('desc3')">Cerrar</button>
          </div>
        </div>
      </div>
      <div class="charts-container2">
        <div class="chart2" id="chart4Container">
          <h2>Ahorro del presupuesto por Tipo de Contratación</h2>
          <h2>Grupo 1</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <h4>Nombre de la Entidad {{nom_ent}}</h4>
          <canvas id="myChart4" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc4')">Descripción</button>
          <div id="desc4" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
            <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
            <button onclick="closeDescription('desc4')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart5Container">
          <h2>Ahorro del presupuesto por Tipo de Contratación</h2>
          <h2>Grupo 2</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <h4>Nombre de la Entidad {{nom_ent}}</h4>
          <canvas id="myChart5" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc5')">Descripción</button>
          <div id="desc5" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
            <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
            <button onclick="closeDescription('desc5')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart6Container">
          <h2>Ahorro del presupuesto por Tipo de Contratación</h2>
          <h2>Grupo 3</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <h4>Nombre de la Entidad {{nom_ent}}</h4>
          <canvas id="myChart6" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc6')">Descripción</button>
          <div id="desc6" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
            <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
            <button onclick="closeDescription('desc6')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart10Container">
          <h2>Ahorro del presupuesto por Tipo de Contratación</h2>
          <h2>Grupo 4</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <h4>Nombre de la Entidad {{nom_ent}}</h4>
          <canvas id="myChart10" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc10')">Descripción</button>
          <div id="desc10" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
            <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
            <button onclick="closeDescription('desc10')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart11Container">
          <h2>Ahorro del presupuesto por Tipo de Contratación</h2>
          <h2>Grupo 5</h2>
          <h4>Provincia {{prov_ent}}</h4>
          <h4>Nombre de la Entidad {{nom_ent}}</h4>
          <canvas id="myChart11" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc11')">Descripción</button>
          <div id="desc11" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Las gráficas se generan dependiendo de cúantos grupos o clusters hayamos escogido inicialmente, si se realizó el agrupamiento con 2 clusters, se generarán unicamente dos gráficos.</p>
            <p>Estas gráficas indican la diferencia que hay en cada tipo de contratación que se obtenga del archivo CSV, si se aplicó el filtro de Nombre de Provincia, se visualizará unicamente la diferencia que hay en cada tipo de contratación para esa provincia en específico.</p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada tipo de contratación</p>
            <button onclick="closeDescription('desc11')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart7Container">
          <h2>Ahorro del presupuesto por Provincia</h2>
          <h2>Grupo 1</h2>
          <h4>Tipo de contratación {{tipo_cont}}</h4>
          <canvas id="myChart7" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc7')">Descripción</button>
          <div id="desc7" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
            <button onclick="closeDescription('desc7')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart8Container">
          <h2>Ahorro del presupuesto por Provincia</h2>
          <h2>Grupo 2</h2>
          <h4>Tipo de contratación {{tipo_cont}}</h4>
          <canvas id="myChart8" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc8')">Descripción</button>
          <div id="desc8" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
            <button onclick="closeDescription('desc8')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart9Container">
          <h2>Ahorro del presupuesto por Provincia</h2>
          <h2>Grupo 3</h2>
          <h4>Tipo de contratación {{tipo_cont}}</h4>
          <canvas id="myChart9" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc9')">Descripción</button>
          <div id="desc9" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
            <button onclick="closeDescription('desc9')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart12Container">
          <h2>Ahorro del presupuesto por Provincia</h2>
          <h2>Grupo 4</h2>
          <h4>Tipo de contratación {{tipo_cont}}</h4>
          <canvas id="myChart12" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc12')">Descripción</button>
          <div id="desc12" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
            <button onclick="closeDescription('desc12')">Cerrar</button>
          </div>
        </div>
        <div class="chart2" id="chart13Container">
          <h2>Ahorro del presupuesto por Provincia</h2>
          <h2>Grupo 5</h2>
          <h4>Tipo de contratación {{tipo_cont}}</h4>
          <canvas id="myChart13" width="900" height="800"></canvas>
          <button onclick="toggleDescription(this, 'desc13')">Descripción</button>
          <div id="desc13" class="chart-description" style="display: none;">
            <!-- Aquí irá la descripción que quieres mostrar -->
            <p>Estas gráficcas indican la diferencia que existe en cada provincia por cada grupo o cluster, si se aplicó el filtro de Tipo de Contratación, se visualizará unicamente la diferencia que hay en cada provincia para ese tipo de contratación en específico. </p>
            <p>Este gráfico indica cuánto es el promedio de la diferencia que existe entre el presupuesto y el valor adjudicado por cada provincia</p>
            <button onclick="closeDescription('desc13')">Cerrar</button>
          </div>
        </div>
      </div>
      


      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // Selecciona todos los checkboxes de control de gráficos
          document.querySelectorAll('.graph-toggle').forEach(function(toggle) {
            toggle.addEventListener('change', function() {
              // Encuentra el contenedor del gráfico basado en el data-target del checkbox
              const chartContainer = document.getElementById(this.getAttribute('data-target') + "Container"); // Asegúrate de que cada ID del contenedor del gráfico termine en "Container"
        
              // Muestra u oculta el contenedor del gráfico
              chartContainer.style.display = this.checked ? 'block' : 'none';
            });
          });
        });
        </script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          //Cargamos las variables con los datos del back
          const data1 = JSON.parse('{{ df_json|safe }}');
          const data2 = JSON.parse('{{ df2_json|safe }}');
          const data3 = JSON.parse('{{ df3_json|safe }}');
          const data4 = JSON.parse('{{ df4_json|safe }}');
          const data5 = JSON.parse('{{ df5_json|safe }}');
          const data6 = JSON.parse('{{ df6_json|safe }}');
          const data7 = JSON.parse('{{ df7_json|safe }}');
          const data8 = JSON.parse('{{ df8_json|safe }}');
          const data9 = JSON.parse('{{ df9_json|safe }}');
          const data10 = JSON.parse('{{ df10_json|safe }}');
          const data11 = JSON.parse('{{ df11_json|safe }}');
          const data12 = JSON.parse('{{ df12_json|safe }}');
          const data13 = JSON.parse('{{ df13_json|safe }}');
          const label = ['Grupo 1', 'Grupo 2', 'Grupo 3', 'Grupo 4', 'Grupo 5'];


          //
          const ctx1 = document.getElementById('myChart');
          const chart1 = new Chart(ctx1, {
            type: 'bar',
            data: {
              labels: label,
              
              datasets: [{
                label: 'Total del Presupuesto por Grupo',
                data: data1.map(item => item.presupuesto),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(34,34,34)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(34,34,34, 1)'], // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });


          const ctx2 = document.getElementById('myChart2');
          const chart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
              labels: label,
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Total del Valor Adjudicado por Grupo',
                data: data2.map(item => item.valAdj),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(34,34,34)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(34,34,34, 1)'], // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }

                }
              }
            }
          });

          const ctx3 = document.getElementById('myChart3');
          const chart3 = new Chart(ctx3, {
            type: 'bar',
            data: {
              labels: label,
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Grupo',
                data: data3.map(item => item.diferencia),
                backgroundColor: ['rgb(156,25,68)', 'rgb(235,169,2)', 'rgb(34,34,34)'],
                borderColor: ['rgba(156,25,68, 1)', 'rgba(235,169,2, 1)', 'rgba(34,34,34, 1)'],// Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });

          const ctx4 = document.getElementById('myChart4');
          const chart4 = new Chart(ctx4, {
            type: 'line',
            data: {
              labels: data4.map(item => item.tipo_contrato_cero),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Tipo de Contratación en Cluster 0',
                data: data4.map(item => item.promedio_diferencia_cero),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx10 = document.getElementById('myChart10');
          const chart10 = new Chart(ctx10, {
            type: 'line',
            data: {
              labels: data10.map(item => item.tipo_contrato_tres),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Tipo de Contratación en Cluster 3',
                data: data10.map(item => item.promedio_diferencia_tres),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx11 = document.getElementById('myChart11');
          const chart11 = new Chart(ctx11, {
            type: 'line',
            data: {
              labels: data11.map(item => item.tipo_contrato_cuatro),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Tipo de Contratación en Cluster 4',
                data: data11.map(item => item.promedio_diferencia_cuatro),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx5 = document.getElementById('myChart5');
          const chart5 = new Chart(ctx5, {
            type: 'line',
            data: {
              labels: data5.map(item => item.tipo_contrato_uno),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Tipo de Contratación en Cluster 1',
                data: data5.map(item => item.promedio_diferencia_uno),
                backgroundColor: 'rgb(235,169,2)',
                borderColor: 'rgba(235,169,2, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx6 = document.getElementById('myChart6');
          const chart6 = new Chart(ctx6, {
            type: 'line',
            data: {
              labels: data6.map(item => item.tipo_contrato_dos),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio de Ahorro por Tipo de Contratación en Cluster 2',
                data: data6.map(item => item.promedio_diferencia_dos),
                backgroundColor: 'rgb(34,34,34)',
                borderColor: 'rgba(34,34,34, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx7 = document.getElementById('myChart7');
          const chart7 = new Chart(ctx7, {
            type: 'line',
            data: {
              labels: data7.map(item => item.provincias_cero),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio del Ahorro por Provincia Cluster 0',
                data: data7.map(item => item.promedio_diferencia_provincia_cero),
                backgroundColor: 'rgb(156,25,68)',
                borderColor: 'rgba(156,25,68, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx8 = document.getElementById('myChart8');
          const chart8 = new Chart(ctx8, {
            type: 'line',
            data: {
              labels: data8.map(item => item.provincias_uno),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio del Ahorro por Provincia Cluster 1',
                data: data8.map(item => item.promedio_diferencia_provincia_uno),
                backgroundColor: 'rgb(235,169,2)',
                borderColor: 'rgba(235,169,2, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx9 = document.getElementById('myChart9');
          const chart9 = new Chart(ctx9, {
            type: 'line',
            data: {
              labels: data9.map(item => item.provincias_dos),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio del Ahorro por Provincia Cluster 2',
                data: data9.map(item => item.promedio_diferencia_provincia_dos),
                backgroundColor: 'rgb(34,34,34)',
                borderColor: 'rgba(34,34,34, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx12 = document.getElementById('myChart12');
          const chart12 = new Chart(ctx12, {
            type: 'line',
            data: {
              labels: data12.map(item => item.provincias_tres),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio del Ahorro por Provincia Cluster 3',
                data: data12.map(item => item.promedio_diferencia_provincia_tres),
                backgroundColor: 'rgb(34,34,34)',
                borderColor: 'rgba(34,34,34, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
          const ctx13 = document.getElementById('myChart13');
          const chart13 = new Chart(ctx13, {
            type: 'line',
            data: {
              labels: data13.map(item => item.provincias_cuatro),
              //labels: labels, // Usa las etiquetas dinámicas
              datasets: [{
                label: 'Promedio del Ahorro por Provincia Cluster 4',
                data: data13.map(item => item.promedio_diferencia_provincia_cuatro),
                backgroundColor: 'rgb(34,34,34)',
                borderColor: 'rgba(34,34,34, 1)', // Usa los datos numéricos dinámicos
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    // Include a dollar sign in the ticks
                    callback: function(value, index, ticks) {
                        return '$' + value.toLocaleString();
                    }
                }
                }
              }
            }
          });
        });
        function toggleDescription(button, id) {
          var description = document.getElementById(id);
          if (description.style.display === "none" || !description.style.display) {
            description.style.display = "block";
            button.classList.add('active');
          } else {
            description.style.display = "none";
            button.classList.remove('active');
          }
        }
        
        function closeDescription(id) {
          var description = document.getElementById(id);
          if (description) {
            description.style.display = "none";
            // Si el botón tiene la clase 'active', la removemos
            var activeButton = document.querySelector('button.active[data-target="' + id + '"]');
            if (activeButton) {
              activeButton.classList.remove('active');
            }
          }
        }
        
        // Asegúrate de que este código se ejecute después de que el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
          // El manejo del evento clic ahora se hace directamente en el HTML con onclick
        });
        
      </script>
    </div>
  </body>
  <footer class="footer">
    Propiedad de la UIDE
  </footer>
</html>
{% endblock content %}